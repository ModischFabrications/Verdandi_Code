<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, shrink-to-fit=no">
    <title>Verdandi Configuration</title>
    <style>
        * {
            font-family: 'Trebuchet MS', sans-serif;
        }
        .width100 {
            width: 100%;
        }
        .config-table td{
            padding: 10px;
        }
        .showDisabled {
            filter: grayscale(0.8) contrast(0.5);;
        }
    </style>
    <script>
        let d = document;
        let showMinutes = true;
        let showSeconds = true;
        let brighenessEl, hourColorEl, minuteColorEl, secondColorEl, pollingEl;

        function toggleHiddenById(id) {
            d.getElementById(id).classList.toggle("showDisabled");
            d.getElementById(id).toggleAttribute("disabled");
        }
        function onload() {
            brighenessEl = d.getElementById("brightnessSlider");
            hourColorEl = d.getElementById("colorH");
            minuteColorEl = d.getElementById("colorM");
            secondColorEl = d.getElementById("colorS");
            pollingEl = d.getElementById("pollInterval");

            /* init value of brightness slider output */
            d.getElementById("brightnessOutput").value = d.getElementById(
                "brightnessSlider"
            ).value;

            loadConfigValues();
        }
        function loadConfigValues() {
            // TODO: load config values with get
        }
        function sendUpdatedData() {
            let urlString = generateUrlString();

            var xhttp = new XMLHttpRequest();
            /* xhttp.open("POST", 'http://192.168.178.159/update', true); */
            xhttp.open("POST", d.URL + "update", true);
            xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhttp.send(urlString);
        }
        function generateUrlString() {
            let showHours = d.getElementById("showHours").checked ? 1 : 0,
                showMinutes = d.getElementById("showMinutes").checked ? 1 : 0,
                showSeconds = d.getElementById("showSeconds").checked ? 1 : 0;

            let brightness = Math.min(Math.max(brighenessEl.value, 0), 255),
                colorH_R = parseInt(hourColorEl.value.slice(1, 3), 16),
                colorH_G = parseInt(hourColorEl.value.slice(3, 5), 16),
                colorH_B = parseInt(hourColorEl.value.slice(5, 7), 16),
                colorM_R = parseInt(minuteColorEl.value.slice(1, 3), 16),
                colorM_G = parseInt(minuteColorEl.value.slice(3, 5), 16),
                colorM_B = parseInt(minuteColorEl.value.slice(5, 7), 16),
                colorS_R = parseInt(secondColorEl.value.slice(1, 3), 16),
                colorS_G = parseInt(secondColorEl.value.slice(3, 5), 16),
                colorS_B = parseInt(secondColorEl.value.slice(5, 7), 16);

            let pollInterval = Math.min(Math.max(pollingEl.value, 0), 10000);

            console.log("Color Hours: ", colorH_R, colorH_G, colorH_B);
            console.log("Color Minutes: ", colorM_R, colorM_G, colorM_B);
            console.log("Color Seconds: ", colorS_R, colorS_G, colorS_B);

            return `
                brightness=${brightness}&
                colorH_R=${colorH_R}&colorH_G=${colorH_G}&colorH_B${colorH_B}&
                colorM_R=${colorM_R}&colorM_G=${colorM_G}&colorM_B${colorM_B}&
                colorS_R=${colorS_R}&colorS_G=${colorS_G}&colorS_B${colorS_B}&
                show_hours=${showHours}&show_seconds=${showMinutes}&show_seconds=${showSeconds}&
                poll_interval_min=${pollInterval}`;
        }
    </script>
</head>
<body onload="onload()">
    <div style="margin: auto;
        width: fit-content;
        padding: 2rem;
        background-color: #efefef;
        height: 100%;
    ">
        <h1 style="border-radius: 1rem;
                margin: auto;
                width: fit-content;
                padding: 2rem;
                background: black;
                color: white;
                margin-bottom: 1rem;
        ">Verdandi Configuration Page</h1>
        <div>
            <table class="config-table width100">
                <tbody>
                    <tr>
                        <td>Brightness:</td>
                        <td colspan="3">
                            <input
                                id="brightnessSlider"
                                type="range"
                                min="0"
                                max="100"
                                value="50"
                                step="5"
                                onmousemove="brightnessOutput.value = this.value"
                                onchange="brightnessOutput.value = this.value"
                                >
                            <output id="brightnessOutput"></output>
                        </td>
                    </tr>
                    <tr>
                        <td>Colors:</td>
                        <td>
                            <input id="showHours" class="css-checkbox" onchange="toggleHiddenById('colorH')" type="checkbox" checked>
                            <label for="colorH" class="css-label">H</label>
                            <input id="colorH" type="color" value="#ff0000">
                        </td>
                        <td>
                            <input id="showMinutes" class="css-checkbox" onchange="toggleHiddenById('colorM')" type="checkbox" checked>
                            <label for="colorM" class="css-label">M</label>
                            <input id="colorM" type="color" value="#00ff00">
                        </td>
                        <td>
                            <input id="showSeconds" class="css-checkbox" onchange="toggleHiddenById('colorS')" type="checkbox" checked>
                            <label for="colorS" class="css-label">S</label>
                            <input id="colorS" type="color" value="#0000ff">
                        </td>
                    </tr>
                    <tr>
                        <td>Poll interval:</td>
                        <td colspan="3">
                            <input id="pollInterval" type="number" max="600" min="1" value="10"> min
                        </td>
                    </tr>
                    <!-- <tr>
                        <td>Time zone:</td>
                        <td colspan="3">
                            <select id="timeZone" name="timezone">
                                <option value="cet">CET (Central European)</option>
                                <option value="est">EST (Eastern Standard)</option>
                                <option value="gmt">GMT (Greenwich Mean)</option>
                                <option value="pst">PST (Pacific Standard)</option>
                              </select>
                        </td>
                    </tr> -->
                </tbody>
            </table>
            <button onclick="sendUpdatedData()">Update</button>
        </div>
    </div>
</body>
</html>